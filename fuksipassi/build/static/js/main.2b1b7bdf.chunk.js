(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{177:function(e,t,a){e.exports=a(357)},182:function(e,t,a){},357:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),l=a(10),r=a.n(l),s=(a(182),a(12)),i=a(9),c=a(15),d=a(13),h=a(14),u=a(418),m=a(25),p=a(50),g=a(401),f=a(403),C=a(404),E=a(419),y=a(407),v=a(408),k=a(161),b=a.n(k),w=a(162),S=a.n(w),j=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleHotkey=function(e){27==e.keyCode?a.props.onClose():13==e.keyCode&&a.state.checked&&a.state.areaFound&&a.handleRegister()},a.handleChange=function(e){return function(t){a.setState(Object(m.a)({},e,t.target.value))}},a.handleCancel=function(){a.props.onClose()},a.handleRegister=function(){var e={email:a.state.email,password:a.state.password,area:a.state.area};a.state.areaPassNeeded&&(e.areaPass=a.state.areaPass),fetch("http://localhost:3000/api/user",{credentials:"same-origin",headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){a.props.onClose(e.message)})},a.checkArea=function(){fetch("http://localhost:3000/api/area/"+a.state.area,{credentials:"same-origin",headers:{"Content-Type":"application/json"},method:"GET"}).then(function(e){return e.json()}).then(function(e){"Area found"==e.message?a.setState({areaFound:!0,checked:!0,areaPassNeeded:e.password}):a.setState({areaFound:!1,checked:!0})})},a.state={email:"",password:"",area:"",checked:!1,areaFound:!1,areaPassNeeded:!1,areaPass:""},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleHotkey)}},{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleHotkey)}},{key:"render",value:function(){return o.a.createElement(g.a,{open:!0},o.a.createElement(f.a,null," Register to Fuksipassi "),o.a.createElement(C.a,null,o.a.createElement("div",null,o.a.createElement(E.a,{label:"Email",onChange:this.handleChange("email")})),o.a.createElement("div",null,o.a.createElement(E.a,{label:"Password",onChange:this.handleChange("password")})),o.a.createElement("div",null,o.a.createElement(E.a,{label:"Area name",onChange:this.handleChange("area")}),o.a.createElement(y.a,{onClick:this.checkArea},"Check"),!this.state.areaFound&&this.state.checked&&o.a.createElement(b.a,{color:"error"}),this.state.areaFound&&o.a.createElement(S.a,{color:"primary"})),this.state.areaPassNeeded&&o.a.createElement(E.a,{value:this.state.areaPass,onChange:this.handleChange("areaPass"),label:"Area password"})),o.a.createElement(v.a,null,o.a.createElement(y.a,{onClick:this.handleCancel,variant:"contained",color:"secondary"},"Cancel"),o.a.createElement(y.a,{onClick:this.handleRegister,variant:"contained",color:"primary",disabled:!this.state.checked},"Register")))}}]),t}(o.a.Component),D=a(172),O=a(360),x=a(409),T=a(422),I=a(4),B=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleHotkey=function(e){27==e.keyCode?a.props.onClose():13==e.keyCode&&a.state.email.length>0&&a.state.password.length>0&&a.state.area.length>0&&a.handleRegister()},a.handleChange=function(e){return function(t){a.setState(Object(m.a)({},e,t.target.value))}},a.handleCheckBox=function(){a.setState({passBool:!a.state.passBool})},a.handleCancel=function(){a.props.onClose()},a.handleRegister=function(){var e={email:a.state.email,password:a.state.password,area:a.state.area};a.state.area_pass.length>0&&(e.areaPass=a.state.area_pass),fetch("http://localhost:3000/api/admin",{credentials:"same-origin",headers:{"Content-type":"application/json"},method:"POST",body:JSON.stringify(e)}).then(function(e){return a.handleErrors(e)}).then(function(e){return e.json()}).then(function(e){a.props.onClose(e.message)})},a.handleErrors=function(e){return e.ok||a.props.onClose(),e},a.state={email:"",password:"",area:"",area_pass:"",passBool:!1},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleHotkey)}},{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleHotkey)}},{key:"render",value:function(){var e=this.props.classes;return o.a.createElement(g.a,{open:!0},o.a.createElement(f.a,null," Create a new area "),o.a.createElement(C.a,null,o.a.createElement("div",null,"Create a new area to store your upcoming challenges and become the admin user of the area."),o.a.createElement(D.a,{className:e.typography},o.a.createElement("b",null,"User ")),o.a.createElement("div",null,o.a.createElement(E.a,{label:"Email",onChange:this.handleChange("email")})),o.a.createElement("div",null,o.a.createElement(E.a,{label:"Password",onChange:this.handleChange("password")})),o.a.createElement(D.a,{className:e.typography},o.a.createElement("b",null,"Area")),o.a.createElement(E.a,{label:"Name",onChange:this.handleChange("area")}),o.a.createElement(O.a,{row:!0},o.a.createElement(x.a,{control:o.a.createElement(T.a,{onChange:this.handleCheckBox,inputProps:{"aria-label":"primary checkbox"},value:this.state.passBool}),label:"Password protected"})),this.state.passBool&&o.a.createElement(E.a,{disabled:!this.state.passBool,label:"Password",onChange:this.handleChange("area_pass")})),o.a.createElement(v.a,null,o.a.createElement(y.a,{onClick:this.handleCancel,variant:"contained",color:"secondary"},"Cancel"),o.a.createElement(y.a,{onClick:this.handleRegister,variant:"contained",color:"primary"},"Register")))}}]),t}(o.a.Component),U=Object(I.a)(function(e){return{root:{display:"flex"},typography:{paddingTop:"20px",paddingBottom:"5px",color:"primary",align:"center"}}})(B),N=a(117),A=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleKeypress=function(e){13==e.keyCode&&""!=a.state.email&&""!=a.state.password?a.login():38==e.keyCode?a.state.focus>0&&(a.setState({focus:a.state.focus-1}),a.focus(a.state.focus)):40==e.keyCode&&a.state.focus<2&&(a.setState({focus:a.state.focus+1}),a.focus(a.state.focus))},a.focus=function(e){0==e?a.emailInput.current.focus():1==e?a.passwordInput.current.focus():a.loginInput.current.focus()},a.auth=function(e,t){a.props.onAuthenticate(e,t)},a.login=function(e){var t={email:a.state.email,password:a.state.password};fetch("http://localhost:5000/api/login",{credentials:"same-origin",headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)}).then(function(e){e.json().then(function(t){200===e.status?a.auth(t.user,t.token):a.setState({message:t.message})})})},a.handleChange=function(e){return function(t){a.setState(Object(m.a)({},e,t.target.value))}},a.handleRegister=function(e){a.setState({message:e,showUserReg:!1,showAdminReg:!1})},a.toggleUserRegister=function(e){a.setState({showUserReg:!a.state.showUserReg})},a.toggleAdminRegister=function(e){a.setState({showAdminReg:!a.state.showAdminReg})},a.state={email:" ",password:"",showUserReg:!1,showAdminReg:!1,message:"",focus:0},a.emailInput=o.a.createRef(),a.passwordInput=o.a.createRef(),a.loginInput=o.a.createRef(),a.handleRegister=a.handleRegister.bind(Object(p.a)(a)),a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.emailInput.current.focus(),window.addEventListener("keydown",this.handleKeypress)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeypress)}},{key:"render",value:function(){return o.a.createElement(N.a,{style:{width:350,padding:20}},o.a.createElement("div",null,o.a.createElement("h1",null," Fuksipassi "),o.a.createElement("h3",null," Sign in "),o.a.createElement(D.a,null,this.state.message),o.a.createElement("div",null,o.a.createElement(E.a,{inputRef:this.emailInput,label:"Email",style:{width:300},type:"email",autoComplete:"email",variant:"outlined",margin:"normal",value:this.state.email,onChange:this.handleChange("email")})),o.a.createElement(E.a,{inputRef:this.passwordInput,label:"Password",style:{width:300,justifyContent:"center"},type:"password",margin:"normal",variant:"outlined",value:this.state.password,onChange:this.handleChange("password")}),o.a.createElement("div",null,o.a.createElement(y.a,{onClick:this.login,style:{backgroundColor:"Lavender"},variant:"contained",buttonRef:this.loginInput},"Login")),o.a.createElement("div",null,o.a.createElement("div",null,o.a.createElement("p",{id:"signup",onClick:this.toggleUserRegister,style:{color:"blue"}},"Create an account?"),this.state.showUserReg&&o.a.createElement(j,{onClose:this.handleRegister})),o.a.createElement("div",null,o.a.createElement("p",{id:"signup",onClick:this.toggleAdminRegister,style:{color:"blue"}},"Create an area?"),this.state.showAdminReg&&o.a.createElement(U,{onClose:this.handleRegister})))))}}]),t}(o.a.Component),P=a(415),L=a(116),R=a(405),H=a(410),F=a(421),z=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleHotkey=function(e){27==e.keyCode?a.props.onClose():13==e.keyCode?a.handleSaving():38!=e.keyCode&&40!=e.keyCode||a.setState({sorting:!a.state.sorting})},a.handleBarColorChange=function(e){a.setState({barColor:e.hex})},a.handleCardColorChange=function(e){a.setState({cardColor:e.hex})},a.handleSortingChange=function(e){var t=e.target.value;t="ascending"==e.target.value?1:0,a.setState({sorting:t})},a.handleSaving=function(){a.props.onSave(a.state.sorting,a.state.barColor,a.state.cardColor)},a.state={barColor:a.props.barColor,sorting:a.props.sorting,cardColor:a.props.cardColor},a.ascended=o.a.createRef(),a.descended=o.a.createRef(),a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleHotkey)}},{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleHotkey)}},{key:"render",value:function(){return o.a.createElement(N.a,null,o.a.createElement("div",{style:{display:"flex"}},o.a.createElement("div",{style:{margin:"20px"}},o.a.createElement(D.a,null,"Theme color"),o.a.createElement(L.SketchPicker,{color:this.state.barColor,onChangeComplete:this.handleBarColorChange})),o.a.createElement("div",{style:{margin:"20px"}},o.a.createElement(D.a,null,"Challenge card color"),o.a.createElement(L.SketchPicker,{color:this.state.cardColor,onChangeComplete:this.handleCardColorChange})),o.a.createElement("div",{style:{margin:"20px"}},o.a.createElement(R.a,null,o.a.createElement(D.a,null," Sort challenges "),o.a.createElement(H.a,{value:this.state.sorting?"ascending":"descending",onChange:this.handleSortingChange},o.a.createElement(x.a,{value:"ascending",control:o.a.createElement(F.a,null),label:"A-Z"}),o.a.createElement(x.a,{value:"descending",control:o.a.createElement(F.a,null),label:"Z-A"}))))),o.a.createElement("div",null,o.a.createElement(y.a,{onClick:this.props.onClose,variant:"contained",color:"secondary",style:{margin:"10px"}},"Go back"),o.a.createElement(y.a,{onClick:this.handleSaving,variant:"contained",color:"primary",style:{margin:"10px"}},"Save")))}}]),t}(o.a.Component),W=a(166),M=a.n(W),J=a(168),V=a.n(J),G=a(169),K=a.n(G),_=a(165),Y=a.n(_),Z=a(170),$=a.n(Z),q=a(423),Q=a(424),X=a(406),ee=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleClose=function(){a.props.onClose()},a.handleDelete=function(){a.props.onDelete(a.state.user.userId)},a.handleChange=function(e){return function(t){var n=t.target.value;n="role"==e?"admin"==t.target.value?1:0:t.target.value,a.setState(Object(m.a)({},e,n))}},a.handleDelete=function(){fetch("http://localhost:3000/api/user/"+a.state.user.userId,{method:"DELETE",mode:"cors",headers:{"Content-type":"application/json",Authorization:"Bearer "+a.props.token},cache:"no-cache"}).then(function(e){e.json().then(function(t){200==e.status?a.props.onDelete(a.state.user.userId):alert(t.message)})})},a.handleUpdate=function(){if(a.validateInputs()){var e=a.state.user;e.email=a.state.email,""!=a.state.password&&(e.password=a.state.password),e.role=a.state.role,fetch("http://localhost:3000/api/user/"+e.userId,{method:"PATCH",mode:"cors",headers:{"Content-type":"application/json",Authorization:"Bearer "+a.props.token},cache:"no-cache",body:JSON.stringify(e)}).then(function(e){e.json().then(function(t){200==e.status?a.props.onEdit(t.user.email):alert(t.message)})}),a.state.editor.userId==a.state.user.userId&&a.state.admin!=e.role&&a.props.onDelete(),a.handleClose()}else alert("Forbidden characters found from input."),a.setState({email:a.state.user.email,password:""}),a.forceUpdate()},a.validateInputs=function(){var e=a.state.email+a.state.password;return!["$","{","}","[","]"].some(function(t){return e.includes(t)})};var n=a.props.targetUser;return a.state={user:n,email:n.email,password:"",role:n.role,admin:a.props.currentUser.role,editor:a.props.currentUser},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return o.a.createElement(g.a,{open:!0,onClose:this.handleDialog},o.a.createElement(f.a,null," Edit user information "),o.a.createElement(C.a,null,o.a.createElement("div",null,o.a.createElement(E.a,{value:this.state.email,margin:"normal",label:"Email",type:"email",onChange:this.handleChange("email")})),o.a.createElement("div",null,o.a.createElement(E.a,{value:this.state.password,margin:"normal",label:"Password",type:"password",onChange:this.handleChange("password")})),this.state.admin?o.a.createElement("div",null,o.a.createElement(R.a,null,o.a.createElement(X.a,null," Role "),o.a.createElement(H.a,{value:this.state.role?"admin":"basic",onChange:this.handleChange("role")},o.a.createElement(x.a,{value:"admin",control:o.a.createElement(F.a,null),label:"Admin"}),o.a.createElement(x.a,{value:"basic",control:o.a.createElement(F.a,null),label:"Basic"})))):null),o.a.createElement(v.a,null,o.a.createElement(y.a,{onClick:this.handleDelete,style:{backgroundColor:"red"},variant:"contained",color:"secondary"},"Unregister"),o.a.createElement(y.a,{onClick:this.handleClose,variant:"contained",color:"primary"},"Cancel"),o.a.createElement(y.a,{onClick:this.handleUpdate,variant:"contained",color:"primary"},"Edit")))}}]),t}(o.a.Component),te=Object(I.a)(function(e){return{root:{display:"flex"},typography:{paddingTop:"20px",paddingBottom:"5px",color:"primary",align:"center"}}})(ee),ae=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).openEditDialog=function(e){a.setState({targetUser:e,showEdit:!0})},a.closeEditDialog=function(){a.setState({showEdit:!1})},a.handleHotkey=function(e){27==e.keyCode&&a.props.onClose()},a.handleUserDelete=function(e){for(var t=a.state.users,n=0;n<t.length;n++)t[n].userId==e&&(t.splice(n,1),a.setState({users:t,showEdit:!1}))},a.state={users:[],message:"",showEdit:!1},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleHotkey)}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("keydown",this.handleHotkey),fetch("http://localhost:3000/api/user",{method:"GET",mode:"cors",headers:{"Content-type":"application/json",Authorization:"Bearer "+this.props.token},cache:"no-cache"}).then(function(t){t.ok?t.json().then(function(t){e.setState({users:t.users})}):e.setState({message:"Your area has everything but users."})})}},{key:"render",value:function(){var e=this;return o.a.createElement(N.a,null,this.state.showEdit&&o.a.createElement(te,{targetUser:this.state.targetUser,currentUser:this.props.user,token:this.props.token,onClose:this.closeEditDialog,onDelete:this.handleUserDelete,onEdit:this.closeEditDialog}),o.a.createElement("div",null,o.a.createElement(D.a,null,"List of users in your area"),o.a.createElement(D.a,null,"Number of users: ",o.a.createElement("b",null,this.state.users.length)),o.a.createElement("table",null,o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("th",null,"Username"),o.a.createElement("th",null,"Role"),o.a.createElement("th",null)),this.state.users.map(function(t){return o.a.createElement("tr",{key:t.userId},o.a.createElement("td",{style:{border:"1px solid #ddd",padding:"8px"}},t.email),o.a.createElement("td",{style:{border:"1px solid #ddd",padding:"8px"}},t.role?o.a.createElement("p",null,"Admin"):o.a.createElement("p",null,"Basic")),o.a.createElement("td",{style:{border:"1px solid #ddd",padding:"8px"}},o.a.createElement(y.a,{onClick:function(){return e.openEditDialog(t)}},"Edit")))}))),o.a.createElement(y.a,{onClick:this.props.onClose,variant:"contained",color:"secondary",style:{margin:"10px"}},"Go back")))}}]),t}(o.a.Component),ne=a(167),oe=a.n(ne),le=a(361),re=a(67),se=a.n(re),ie=a(411),ce=a(412),de=a(413),he=a(414),ue=a(68),me=a.n(ue),pe=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleUpload=function(e){"undefined"===typeof e.target.files[0]?a.setState({message:""}):e.target.files[0].size/1024/1024<2?a.setState({disableComplete:!1,file:e.target.files,message:""}):a.setState({message:"File size exceeds limits."})},a.handleComplete=function(){a.props.onComplete(a.state.file)},a.state={title:a.props.title,file:"",message:"",disableComplete:!0},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(g.a,{open:!0},o.a.createElement(f.a,null," Complete challenge "),o.a.createElement(C.a,null,this.state.title,o.a.createElement("p",null,"Upload image as a proof of completion"),o.a.createElement(D.a,{gutterBottom:!0,variant:"h6",component:"h2",color:"secondary"},this.state.message),o.a.createElement("div",null,o.a.createElement("input",{type:"file",id:"file-browser input",name:"file-browser-input",ref:function(t){return e.fileInput=t},onDragOver:function(e){e.preventDefault(),e.stopPropagation()},onDrop:this.handleUpload,onChange:this.handleUpload,style:{borderStyle:"dashed",width:400,height:50}}),o.a.createElement("div",null,"Drag image here or browse from folders (size limit is 2 MB)"))),o.a.createElement(v.a,null,o.a.createElement(y.a,{onClick:this.props.onCancel,variant:"contained",color:"secondary"},"Cancel"),o.a.createElement(y.a,{onClick:this.handleComplete,variant:"contained",disabled:this.state.disableComplete,color:"primary"},"Complete")))}}]),t}(o.a.Component),ge=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleHotkey=function(e){27==e.KeyCode?a.props.onClose():13==e.KeyCode&&a.props.onDeletion()},a.handleDeletion=function(){a.props.onDeletion()},a.state={title:a.props.title},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleHotkey)}},{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleHotkey)}},{key:"render",value:function(){return o.a.createElement(g.a,{open:!0},o.a.createElement(f.a,null," Delete a challenge "),o.a.createElement(C.a,null,o.a.createElement(D.a,null,o.a.createElement("i",null,this.state.title)),"Are you sure you want to delete this challenge? All information about the completions of this challenge will also be deleted."),o.a.createElement(v.a,null,o.a.createElement(y.a,{onClick:this.props.onCancel,variant:"contained",color:"primary"},"Cancel"),o.a.createElement(y.a,{onClick:this.handleDeletion,variant:"contained",color:"secondary"},"Delete")))}}]),t}(o.a.Component),fe=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleCompletion=function(e){a.handleDialog(),a.props.onCompletion(a.state.challenge.challengeId,e)},a.handleDeletionDialog=function(){a.setState({showDelDialog:!a.state.showDelDialog})},a.handleDeletion=function(){a.props.onDeletion(a.state.challenge.challengeId),a.handleDeletionDialog()},a.handleExpansion=function(){a.setState({expanded:!a.state.expanded,showDialog:!1})},a.handleDialog=function(){a.setState({showCompDialog:!a.state.showCompDialog})},a.download=function(e,t){var a=document.createElement("a");a.setAttribute("id",e),a.href="data:image/jpeg;base64,".concat(t),a.download=e,document.body.appendChild(a),a.click()},a.undoneCard=function(){var e=a.props.classes;return o.a.createElement(ie.a,{className:e.card,style:{backgroundColor:a.state.cardColor}},o.a.createElement("img",{alt:"Thumbtack",className:e.thumbtack,src:"/tack.png"}),o.a.createElement(ce.a,null,o.a.createElement(D.a,{gutterBottom:!0,variant:"h6",component:"h2"},a.state.challenge.title)),o.a.createElement(de.a,{className:e.actions},o.a.createElement(le.a,{className:se()(e.expand,Object(m.a)({},e.expandOpen,a.state.expanded)),onClick:a.handleExpansion,"aria-expanded":a.state.expanded},o.a.createElement(me.a,null)),0==a.state.admin?o.a.createElement(y.a,{size:"small",color:"primary",onClick:a.handleDialog},"Complete"):null,1==a.state.admin?o.a.createElement(y.a,{size:"small",color:"primary",onClick:a.handleDeletionDialog},"Delete"):null),o.a.createElement(he.a,{in:a.state.expanded,timeout:"auto",unmountOnExit:!0},o.a.createElement(ce.a,null,o.a.createElement(D.a,{paragraph:!0},a.state.challenge.description))))},a.unverifiedCard=function(){var e=a.props.classes;return o.a.createElement(ie.a,{className:e.card,style:{backgroundColor:a.state.cardColor}},o.a.createElement("img",{alt:"Thumbtack",className:e.thumbtack,src:"/tack.png"}),o.a.createElement(ce.a,null,o.a.createElement(D.a,{gutterBottom:!0,variant:"h6",component:"h2"},a.state.challenge.title)),o.a.createElement(de.a,{className:e.actions},o.a.createElement(le.a,{className:se()(e.expand,Object(m.a)({},e.expandOpen,a.state.expanded)),onClick:a.handleExpansion,"aria-expanded":a.state.expanded},o.a.createElement(me.a,null)),o.a.createElement(y.a,{size:"small",color:"primary",onClick:function(){return a.props.onDelete(a.props.userId,a.state.challenge.challengeId)}},"Delete")),o.a.createElement(he.a,{in:a.state.expanded,timeout:"auto",unmountOnExit:!0},o.a.createElement(ce.a,null,o.a.createElement(D.a,{paragraph:!0},a.state.challenge.description),o.a.createElement("img",{className:e.media,src:"data:image/jpeg;base64,".concat(a.state.challenge.image.img.data),alt:"Proof of completion"}))))},a.pendingCard=function(){var e=a.props.classes;return o.a.createElement(ie.a,{className:e.card,style:{backgroundColor:a.state.cardColor}},o.a.createElement("img",{alt:"Thumbtack",className:e.thumbtack,src:"/tack.png"}),o.a.createElement(ce.a,null,o.a.createElement(D.a,{gutterBottom:!0,variant:"h6",component:"h2"},a.state.challenge.info.title),o.a.createElement(D.a,null,o.a.createElement("b",null,"User:")," ",a.state.challenge.email)),o.a.createElement(de.a,{className:e.actions},o.a.createElement(le.a,{className:se()(e.expand,Object(m.a)({},e.expandOpen,a.state.expanded)),onClick:a.handleExpansion,"aria-expanded":a.state.expanded},o.a.createElement(me.a,null)),o.a.createElement(y.a,{size:"small",color:"secondary",variant:"contained",onClick:function(){return a.props.onDelete(a.state.challenge.userId,a.state.challenge.challengeId)}},"Delete"),o.a.createElement(y.a,{size:"small",color:"primary",variant:"contained",onClick:function(){return a.props.onVerify(a.state.challenge.userId,a.state.challenge.challengeId)}},"Verify")),o.a.createElement(he.a,{in:a.state.expanded,timeout:"auto",unmountOnExit:!0},o.a.createElement(ce.a,null,o.a.createElement(D.a,{paragraph:!0},a.state.challenge.info.description),o.a.createElement("img",{className:e.media,src:"data:image/jpeg;base64,".concat(a.state.challenge.img.data),alt:"Proof of completion"}))))},a.doneCard=function(){var e=a.props.classes;return o.a.createElement(ie.a,{className:e.card,style:{backgroundColor:a.state.cardColor}},o.a.createElement("img",{alt:"Thumbtack",className:e.thumbtack,src:"/tack.png"}),o.a.createElement(ce.a,null,o.a.createElement(D.a,{gutterBottom:!0,variant:"h6",component:"h2"},a.state.challenge.title),o.a.createElement(D.a,null,o.a.createElement("b",null,"Date of completion:")," ",a.state.challenge.image.date)),o.a.createElement(de.a,{className:e.actions},o.a.createElement(le.a,{className:se()(e.expand,Object(m.a)({},e.expandOpen,a.state.expanded)),onClick:a.handleExpansion,"aria-expanded":a.state.expanded},o.a.createElement(me.a,null))),o.a.createElement(he.a,{in:a.state.expanded,timeout:"auto",unmountOnExit:!0},o.a.createElement(ce.a,null,o.a.createElement(D.a,null,a.state.challenge.description),o.a.createElement("img",{className:e.media,src:"data:image/jpeg;base64,".concat(a.state.challenge.image.img.data),alt:"Proof of completion"}),o.a.createElement(y.a,{onClick:function(){return a.download(a.state.challenge.title,a.state.challenge.image.img.data)}},"Download image"))))},a.state={type:a.props.type,challenge:a.props.challenge,expanded:!1,showCompDialog:!1,showDelDialog:!1,admin:a.props.admin,cardColor:a.props.color},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(e){e.challenge!==this.props.challenge&&this.setState({challenge:this.props.challenge}),e.color!==this.props.color&&this.setState({cardColor:this.props.color})}},{key:"render",value:function(){return o.a.createElement("div",null,this.state.showCompDialog&&o.a.createElement(pe,{onCancel:this.handleDialog,onComplete:this.handleCompletion}),0==this.props.type&&this.undoneCard(),1==this.props.type&&this.unverifiedCard(),2==this.props.type&&this.pendingCard(),3==this.props.type&&this.doneCard(),this.state.showDelDialog&&o.a.createElement(ge,{title:this.state.challenge.title,onCancel:this.handleDeletionDialog,onDeletion:this.handleDeletion}))}}]),t}(o.a.Component),Ce=Object(I.a)(function(e){return{card:{backgroundColor:"#FFFF88",flex:1,justifyContent:"center",alignItems:"center",minWidth:350,maxWidth:500},media:{maxHeight:250,maxWidth:500,paddingTop:"5%",marginLeft:"auto",marginRight:"auto",display:"block"},thumbtack:{height:"55px",maxWidth:"57px",position:"relative",top:"15px",right:"10px",display:"block"},actions:{display:"flex"},expand:{transform:"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})},expandOpen:{transform:"rotate(180deg)"}}})(fe),Ee=a(420),ye=a(416),ve=a(417),ke=a(164),be=a.n(ke),we=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleHotkey=function(e){27==e.keyCode?a.props.onClose():13==e.keyCode&&a.state.title.length>0&&a.state.description.length>0&&a.handleCreation()},a.handleChange=function(e){return function(t){a.setState(Object(m.a)({},e,t.target.value))}},a.handleCancel=function(){a.props.onClose()},a.handleCreation=function(){var e={title:a.state.title,description:a.state.description};fetch("http://localhost:3000/api/challenge",{credentials:"same-origin",headers:{"Content-type":"application/json",Authorization:"Bearer "+a.props.token},method:"POST",body:JSON.stringify(e)}).then(function(e){e.ok?a.props.onClose():e.json(function(e){a.setState({message:e.message})})})},a.state={title:"",description:"",message:""},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleHotkey)}},{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleHotkey)}},{key:"render",value:function(){var e=this.props.classes;return o.a.createElement(g.a,{open:!0},o.a.createElement(f.a,null," Challenge creation "),o.a.createElement(C.a,null,o.a.createElement("div",null,"Create a new challenge for users to complete. This challenge is only going to be seen by members in your challenge area."),o.a.createElement(D.a,{className:e.typography}," Challenge "),o.a.createElement("div",null,o.a.createElement(E.a,{className:e.fields,label:"Title",onChange:this.handleChange("title")})),o.a.createElement("div",null,o.a.createElement(E.a,{className:e.fields,label:"Description",multiline:!0,onChange:this.handleChange("description")}))),o.a.createElement(v.a,null,o.a.createElement(y.a,{onClick:this.handleCancel,variant:"contained",color:"secondary"},"Cancel"),o.a.createElement(y.a,{onClick:this.handleCreation,variant:"contained",color:"primary"},"Create")))}}]),t}(o.a.Component),Se=Object(I.a)(function(e){return{root:{display:"flex"},typography:{paddingTop:"20px",paddingBottom:"5px",color:"primary",align:"center"}}})(we),je=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleHotkey=function(e){var t=a.state.tabValue;37==e.keyCode?(t>0&&t--,a.setState({tabValue:t})):39==e.keyCode&&((t<2&&0==a.state.user.role||t<1&&a.state.user.role)&&t++,a.setState({tabValue:t}))},a.getChallenges=function(){var e=!1;0==a.state.user.role?(fetch(a.state.url+"challenge/done/"+a.state.user.userId,{method:"GET",headers:{"Content-type":"application/json",Authorization:"Bearer "+a.state.token},cache:"no-cache"}).then(function(e){e.json().then(function(e){if(a.state.mounted&&"undefined"!==typeof e.data){for(var t=[],n=0;n<e.data.length;n++)t.push(e.data[n][0]);var o=a.sortByName(a.state.sortingType,t);a.setState({doneChall:o})}})}),fetch(a.state.url+"challenge/pending/"+a.state.user.userId,{method:"GET",headers:{"Content-type":"application/json",Authorization:"Bearer "+a.state.token},cache:"no-cache"}).then(function(e){e.json().then(function(e){if(a.state.mounted&&"undefined"!==typeof e.data){for(var t=new Array,n=0;n<e.data.length;n++)t.push(e.data[n][0]);var o=a.sortByName(a.state.sortingType,t);a.setState({unverifiedChall:o})}})})):fetch(a.state.url+"challenge/pending",{method:"GET",headers:{"Content-type":"application/json",Authorization:"Bearer "+a.state.token},cache:"no-cache"}).then(function(t){t.json().then(function(n){if(t.ok){if(a.state.mounted&&"undefined"!==typeof n.data){for(var o=new Array,l=0;l<n.data.length;l++)o.push(n.data[l][0]);var r=a.sortByName(a.state.sortingType,o);a.setState({pendingChall:r})}}else e||(a.props.onLogout(),e=!0)})}),fetch(a.state.url+"challenge/undone/"+a.state.user.userId,{method:"GET",headers:{"Content-type":"application/json",Authorization:"Bearer "+a.state.token},cache:"no-cache"}).then(function(t){t.json().then(function(n){if(t.ok){if(a.state.mounted&&"undefined"!==typeof n.data){var o=a.sortByName(a.state.sortingType,n.data);a.setState({undoneChall:o})}}else e||(a.props.onLogout(),e=!0)})})},a.handleCreationClick=function(){a.state.showCreatDialog&&a.getChallenges(),a.setState({showCreatDialog:!a.state.showCreatDialog})},a.handleDeletion=function(e){fetch(a.state.url+"challenge/"+e,{method:"DELETE",headers:{"Content-type":"application/json",Authorization:"Bearer "+a.state.token},cache:"no-cache"}).then(function(e){e.ok&&a.getChallenges()})},a.handleVerification=function(e,t){fetch(a.state.url+"challenge/verify/"+e+"/"+t,{method:"PATCH",headers:{"Content-type":"application/json",Authorization:"Bearer "+a.state.token},cache:"no-cache"}).then(function(e){e.ok&&a.getChallenges()})},a.handleEntryDeletion=function(e,t){fetch(a.state.url+"entry/"+e+"/"+t,{method:"DELETE",headers:{"Content-type":"application/json",Authorization:"Bearer "+a.state.token},cache:"no-cache"}).then(function(e){e.ok&&a.getChallenges()})},a.handleCompletion=function(e,t){var n={userId:a.state.user.userId,challengeId:e,file:t[0]},o=new FormData;for(var l in n)o.append(l,n[l]);fetch(a.state.url+"entry",{method:"POST",headers:{Authorization:"Bearer "+a.state.token},cache:"no-cache",body:o}).then(function(e){e.ok&&a.getChallenges()})},a.sortByName=function(e,t){var a=t.slice();return a.length>0&&("undefined"==typeof a[0].title?1===e?a.sort(function(e,t){return(""+e.info.title).localeCompare(t.info.title)}):a.sort(function(e,t){return(""+t.info.title).localeCompare(e.info.title)}):1===e?a.sort(function(e,t){return(""+e.title).localeCompare(t.title)}):a.sort(function(e,t){return(""+t.title).localeCompare(e.title)})),a},a.handleTabChange=function(e,t){a.setState({tabValue:t})},a.state={barColor:a.props.color,user:a.props.user,token:a.props.token,undoneChall:[],doneChall:[],pendingChall:[],unverifiedChall:[],url:"http://localhost:3000/api/",tabValue:0,showCreatDialog:!1,message:"",mounted:!1,sortingType:a.props.sortingType},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(e){e.color!==this.props.color?this.setState({barColor:this.props.color}):e.sortingType!==this.props.sortingType&&this.setState({sortingType:this.props.sortingType})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleHotkey),this.setState({mounted:!1})}},{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleHotkey),this.setState({mounted:!0}),this.getChallenges()}},{key:"doneContent",value:function(){var e=this;return this.state.doneChall.map(function(t){return o.a.createElement("li",{key:t.image.date,style:{margin:"30px",listStyleType:"none"}},o.a.createElement("div",{style:{display:" flex",justifyContent:"center"}},o.a.createElement(Ce,{challenge:t,type:"3",color:e.props.cardColor})))})}},{key:"unverifiedContent",value:function(){var e=this;return this.state.unverifiedChall.map(function(t){return o.a.createElement("li",{key:t.image.date,style:{margin:"30px",listStyleType:"none"}},o.a.createElement("div",{style:{display:" flex",justifyContent:"center"}},o.a.createElement(Ce,{challenge:t,type:"1",userId:e.state.user.userId,onDelete:e.handleEntryDeletion,color:e.props.cardColor})))})}},{key:"pendingContent",value:function(){var e=this;if("undefined"!==typeof this.state.pendingChall&&this.state.pendingChall.length>0)return this.state.pendingChall.map(function(t){return o.a.createElement("li",{key:t._id,style:{margin:"30px",listStyleType:"none"}},o.a.createElement("div",{style:{display:" flex",justifyContent:"center"}},o.a.createElement(Ce,{challenge:t,onDelete:e.handleEntryDeletion,onVerify:e.handleVerification,color:e.props.cardColor,type:"2"})))})}},{key:"undoneContent",value:function(){var e=this;if("undefined"!==typeof this.state.undoneChall)return this.state.undoneChall.map(function(t){return o.a.createElement("li",{key:t.challengeId,style:{margin:"30px",listStyleType:"none"}},o.a.createElement("div",{style:{display:" flex",justifyContent:"center"}},o.a.createElement(Ce,{challenge:t,type:"0",onCompletion:e.handleCompletion,onDeletion:e.handleDeletion,color:e.props.cardColor,admin:e.state.user.role})))})}},{key:"render",value:function(){var e=this.props.classes,t=this.state.tabValue;return o.a.createElement("div",null,o.a.createElement(P.a,{className:e.appbar,style:{backgroundColor:this.state.barColor},position:"static"},o.a.createElement(Ee.a,{TabIndicatorProps:{style:{backgroundColor:"#000",height:"3px"}},centered:!0,value:t,onChange:this.handleTabChange},o.a.createElement(ye.a,{label:"Incompleted"}),o.a.createElement(ye.a,{label:"Pending"}),0==this.state.user.role&&o.a.createElement(ye.a,{label:"Completed"}))),0==t&&this.undoneContent(),1==this.state.user.role?o.a.createElement("div",null,1==t&&this.pendingContent()):o.a.createElement("div",null,1==t&&this.unverifiedContent(),2==t&&this.doneContent()),1==this.state.user.role?o.a.createElement(ve.a,{color:"primary","aria-label":"Add",style:{bottom:"5%",right:"5%",position:"absolute",backgroundColor:this.state.barColor},onClick:this.handleCreationClick},o.a.createElement(be.a,null)):null,this.state.showCreatDialog&&o.a.createElement(Se,{token:this.state.token,onClose:this.handleCreationClick}))}}]),t}(o.a.Component),De=Object(I.a)(function(e){return{appbar:{color:"#ffffff"}}})(je),Oe=function(e){function t(e){return Object(s.a)(this,t),Object(c.a)(this,Object(d.a)(t).call(this,e))}return Object(h.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return o.a.createElement(N.a,{style:{maxWidth:"800px"}},o.a.createElement("div",{style:{margin:"30px"}},o.a.createElement(D.a,{align:"center",gutterBottom:!0,variant:"h6"},"What is Fuksipassi?"),o.a.createElement("p",null,"Fuksipassi is a web application, where users can complete challenges and upload pictures as proof of the completion. Anyone can create a new area and start creating their challenges there."),o.a.createElement("p",null,"To join another area after already joining some area, you have to make a new user or delete your current one and register again to the other area."),o.a.createElement(D.a,{align:"center",gutterBottom:!0,variant:"h6"},"Challenges"),o.a.createElement("p",null,'Incompleted challenges are found from the tab "Incompleted". You can complete these challenges by pressing the button "Complete". Drag and drop an image or choose from your folders to activate the completion button. File size limit is 2 MB.'),o.a.createElement("p",null,"Pending tab shows challenges that have been completed, but which haven't been verified by admins of the area. Admins can delete or verify the challenge depending on how they decide."),o.a.createElement("p",null,"For admins, pending tab shows all the completed, but not yet verified challenges in their area. Email of the user is being shown along with the image of the challenge."),o.a.createElement("p",null,'Completed tab shows the challenges which have been verified and accepted by admins. Images can be downloaded by expanding the card and clicking the button "Download image".'),o.a.createElement(D.a,{align:"center",gutterBottom:!0,variant:"h6"},"Hotkeys"),o.a.createElement("p",null,"There are number of hotkeys present to assist in using the web application. They are listed below."),o.a.createElement("ul",null,o.a.createElement("li",null,o.a.createElement("b",null,"Insert"),": Settings menu"),o.a.createElement("li",null,o.a.createElement("b",null,"End"),": Log out"),o.a.createElement("li",null,o.a.createElement("b",null,"Delete"),": See user list (Only for admins)"),o.a.createElement("li",null,o.a.createElement("b",null,"Home"),": Edit your user")),o.a.createElement(y.a,{onClick:this.props.onClose,variant:"contained",color:"primary"},"Go back")))}}]),t}(o.a.Component),xe=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(c.a)(this,Object(d.a)(t).call(this))).handleHotkey=function(t){36==t.keyCode?e.handleProfile():35==t.keyCode?e.handleLogout():46==t.keyCode&&1==e.state.user.role?e.handleUserList():45==t.keyCode&&e.handleSettings()},e.setAuthenticate=function(t,a){e.setState({user:t,auth:!0,token:a}),localStorage.setItem("user",JSON.stringify(t)),localStorage.setItem("token",a);var n={timestamp:(new Date).getTime()};localStorage.setItem("session",JSON.stringify(n))},e.handleLogout=function(){fetch("http://localhost:3000/api/logout",{method:"GET",mode:"cors",headers:{"Content-type":"application/json",Authorization:"Bearer "+e.state.token},cache:"no-cache"}).then(e.setState({token:null,auth:!1,editProfile:!1})),localStorage.clear()},e.handleProfile=function(){e.setState({editProfile:!e.state.editProfile})},e.handleEdit=function(t){var a=e.state.user;a.email=t,e.setState({user:a})},e.handleHelp=function(){e.setState({showHelp:!e.state.showHelp})},e.handleDrawerToggle=function(){e.setState({openDrawer:!e.state.openDrawer})},e.handleSettings=function(){e.setState({showSettings:!e.state.showSettings})},e.handleUserList=function(){e.setState({showUsers:!e.state.showUsers})},e.handleUndo=function(){e.setState({previousCardColor:e.state.cardColor,previousBarColor:e.state.barColor,barColor:e.state.previousBarColor,cardColor:e.state.previousCardColor,undo:!1,redo:!0})},e.handleRedo=function(){e.setState({previousCardColor:e.state.cardColor,previousBarColor:e.state.barColor,barColor:e.state.previousBarColor,cardColor:e.state.previousCardColor,redo:!1,undo:!0})},e.handleSettingsSave=function(t,a,n){var o=!1;localStorage.getItem("color")!=a&&a!=e.state.barColor&&(o=!0),localStorage.getItem("cardColor")!=n&&n!=e.state.cardColor&&(o=!0),localStorage.setItem("color",a),localStorage.setItem("cardColor",n),localStorage.setItem("sortingType",t),e.setState({redo:!1,undo:o,previousCardColor:e.state.cardColor,previousBarColor:e.state.barColor,barColor:a,cardColor:n,sortingType:t}),e.handleSettings()},e.state={auth:!1,user:"",token:"",barColor:"#FFBB4C",cardColor:"#FFFF88",previousBarColor:"",previousCardColor:"",redo:!1,undo:!1,editProfile:!1,showSettings:!1,showUsers:!1,openDrawer:!1,showHelp:!1,sortingType:1},e}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){if(window.addEventListener("keydown",this.handleHotkey),null!==localStorage.getItem("color")&&this.setState({barColor:localStorage.getItem("color")}),null!==localStorage.getItem("cardColor")&&this.setState({cardColor:localStorage.getItem("cardColor")}),null!==localStorage.getItem("sortingType")&&this.setState({sortingType:localStorage.getItem("sortingType")}),null!==localStorage.getItem("session")){var e=JSON.parse(localStorage.getItem("session")),t=new Date(e.timestamp),a=new Date(t.setMinutes(t.getMinutes()+15));(new Date).getTime()<a.getTime()&&this.setState({auth:!0,token:localStorage.getItem("token"),user:JSON.parse(localStorage.getItem("user"))})}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleHotkey)}},{key:"render",value:function(){return o.a.createElement("div",{className:"App"},this.state.auth?o.a.createElement("div",null,this.state.showSettings||this.state.showUsers||this.state.showHelp?o.a.createElement("div",null,this.state.showSettings&&o.a.createElement("div",{style:{display:" flex",justifyContent:"center"}},o.a.createElement(z,{barColor:this.state.barColor,cardColor:this.state.cardColor,sorting:this.state.sortingType,onClose:this.handleSettings,onSave:this.handleSettingsSave})),this.state.showUsers&&o.a.createElement("div",{style:{display:" flex",justifyContent:"center"}},o.a.createElement(ae,{onClose:this.handleUserList,token:this.state.token,user:this.state.user})),this.state.showHelp&&o.a.createElement("div",{style:{display:" flex",justifyContent:"center"}},o.a.createElement(Oe,{onClose:this.handleHelp}))):o.a.createElement("div",null,o.a.createElement(P.a,{position:"static",style:{backgroundColor:this.state.barColor}},o.a.createElement(q.a,{onClick:this.handleDrawerToggle,width:300,open:this.state.openDrawer},o.a.createElement(Q.a,{onClick:this.handleSettings},"Settings"),this.state.user.role?o.a.createElement(Q.a,{onClick:this.handleUserList},"List of users"):null),o.a.createElement("div",{style:{display:"flex"}},o.a.createElement(le.a,{onClick:this.handleDrawerToggle},o.a.createElement(Y.a,null)),o.a.createElement(D.a,{style:{margin:20}},"Logged in as ",this.state.user.email),o.a.createElement(D.a,{style:{margin:20}},"Current area: ",o.a.createElement("b",null," ",this.state.user.area)),o.a.createElement(le.a,{onClick:this.handleLogout},o.a.createElement(M.a,null)),o.a.createElement(le.a,{onClick:this.handleProfile},o.a.createElement(oe.a,null)),o.a.createElement(le.a,{disabled:!this.state.undo,onClick:this.handleUndo},o.a.createElement(V.a,null)),o.a.createElement(le.a,{disabled:!this.state.redo,onClick:this.handleRedo},o.a.createElement(K.a,null)),o.a.createElement(le.a,{onClick:this.handleHelp},o.a.createElement($.a,null)))),o.a.createElement(De,{sortingType:this.state.sortingType,user:this.state.user,token:this.state.token,onLogout:this.handleLogout,color:this.state.barColor,cardColor:this.state.cardColor}),this.state.editProfile&&o.a.createElement(te,{targetUser:this.state.user,currentUser:this.state.user,token:this.state.token,onClose:this.handleProfile,onDelete:this.handleLogout,onEdit:this.handleEdit}))):o.a.createElement(u.a,{container:!0,spacing:0,direction:"column",alignItems:"center",justify:"center",style:{minHeight:"100vh"}},o.a.createElement(u.a,{item:!0,xs:3},o.a.createElement(A,{onAuthenticate:this.setAuthenticate}))))}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(xe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[177,1,2]]]);
//# sourceMappingURL=main.2b1b7bdf.chunk.js.map